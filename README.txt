= jawptool =

'''jawptool'''とは、ウィキペディア日本語版のダンプデータを対象にデータ処理を行うプログラム。

ウィキペディア日本語版を編集していると、「ああ、このミスって機械的にチェックできそうだなぁ」と思うことがよくあったので、実際にチェックするツールを作ってみたというのがスタートです。チェックするには、ウィキペディアのデータを用意しなければなりませんが、そのためにクローラを作ってサイトにアクセスするなんてのは非道です。そして、実際そのような用途のためにデータベースダンプ http://dumps.wikimedia.org/jawiki/ が用意されていますので、そちらを使ってチェックするようにしました。そうして出来上がったのが、wpja-lint.plというプログラムです(非公開)。

チェックは出来たのですが、プログラムを作っているうちに「統計処理をしたら面白いかな」とか色々夢が膨らんできたので、チェック(lint)専用のツールではなく、汎用的なツールとして作り直したのが、このjawptoolです。(wpja→jawpのミスもここで修正しました)。

== 機能 ==
=== jawptool.pl ===
;lint-title
:記事名のチェックを行います。
:レポートの冒頭にも書いていますが、このチェックに引っかかったからといって、必ずしも間違った記事名というわけではありません。改名する場合は、その改名が適切か個別に判断してから行うようにお願いいたします。
:もちろん、プログラムのバグで誤って判定されている場合もあります。その場合は、バグレポートを出していただけると助かります。

;lint-text
:記事本文の文法チェックを行います。
:こちらもレポートの冒頭にも書いていますが、このチェックに引っかかったからといって、必ずしも間違っているとは限りません。修正を行う場合は、個別に判断してから行うようにお願いいたします。

;lint-redirect
:リダイレクト記事のチェックを行います。
:こちらもレポートの冒頭にも書いていますが、このチェックに引っかかったからといって、必ずしも間違っているとは限りません。修正を行う場合は、個別に判断してから行うようにお願いいたします。
:赤リンクへのリダイレクトは[[迷子のリダイレクト]]に類似しますが、jawptoolではリンク先の節が無いものも検出している点が違います。

;lint-index
:索引記事のチェックを行います。
:こちらもレポートの冒頭にも書いていますが、このチェックに引っかかったからといって、必ずしも間違っているとは限りません。修正を行う場合は、個別に判断してから行うようにお願いいたします。

;statistic
:記事データの統計情報をとります。

;titlelist
:タイトル一覧データを名前空間ごとにperlのハッシュ形式で出力します。

;living-noref
:存命人物記事で出典のないものの一覧を出力します。

;longterm-request
:依頼・提案タグが貼られてから3ヶ月以上経過した記事の一覧を出力します。
:議論が長引いていることもあり得ますが、提出されていなくて誰の目にも触れられていないという場合もあります。そうした記事の検出を目的とします。

;person
:人物一覧記事の加筆候補を出力します。

;noindex
;索引未掲載記事の一覧を出力します。

;index-statistic
:索引記事の統計情報に出力します。

;aimai
:曖昧さ回避記事の加筆候補を出力します。

;shortpage
:短い(1000バイト未満)の記事の一覧を出力します。

;lonelypage
:どの記事からも内部リンクされていない記事の一覧を出力します。

;category-statistic
:カテゴリごとに、そのカテゴリに属する記事の統計情報を出力します。

全てのレポートに言えることですが、チェック結果を元にした機械的な修正は厳に謹んで下さい。チェックに引っかかったとしても、必要があってわざとガイドラインを逸脱している可能性もあります。プログラムの開発時より後にガイドラインが更新されている可能性もあります。必ず実際の記事とガイドラインを確認の上で修正を行うようにしてください。

=== CGI ===
;lint-title.cgi
:lint-titleをCGI経由で実行するものです。

;lint-text.cgi
:lint-textをCGI経由で実行するものです。文法チェックは記事単位で行います。

== 動作環境 ==
jawptoolを使用するにはperl5.8以降が必要です。いくつかのperlモジュールを使用していますがいずれもコアモジュールですので追加でインストールする必要はありません。

データベースダンプはbzip2で圧縮されて公開されていますので、bzip2を展開するツールが別途必要になります。

== 使用法 ==
=== jawptool.pl ===
プログラムのインストールの手順は特にありません。jawptool.plとJAWP.pmを作業用ディレクトリに置いてください。環境によっては、jawptoo.plの先頭行のperlのパスを修正する必要があるかもしれません。

解析するデータは http://dumps.wikimedia.org/jawiki/ よりダウンロードしてきます。基本的にpages-meta-current.xml.bz2か、pages-articles.xml.bz2のどちらかを使用します。jawptoolは標準入力からデータを受け取ることができませんので、bzip2は事前に解凍しておいてください。

usageは次の通りです。
<pre>
jawptool 0.30

Usage: jawptool.pl command xmlfile reportfile

command:
  lint-title
  lint-text
  lint-redirect
  lint-index
  statistic
  titlelist
  living-noref
  longterm-request
  person
  noindex
  index-statistic
  aimai
  shortpage
  lonelypage
  category-statistic
</pre>

=== lint-title.cgi ===
lint-title.cgiとJAWP.pmをウェブサーバからアクセスできるディレクトリに置いてください。ウェブブラウザからjawp-title.cgiにアクセスすると、テキストフォームが表示されますので、そこに記事名を入力し「lint」ボタンを押すとtext-titleの結果が表示されます。

=== lint-text.cgi ===
lint-text.cgiとJAWP.pmをウェブサーバからアクセスできるディレクトリに置いてください。ウェブブラウザからlint-text.cgiにアクセスすると、テキストフォームが表示されますので、そこにウィキテキストを入力し「lint」ボタンを押すとtext-lintの結果が表示されます。

== 歴史 ==
*2011年5月17日 - 初めてプログラムの構想を思いつく。
*2011年5月19日 - wpja-lintの開発開始。
*2011年5月27日 - wpjatoolに名称変更。
*2011年5月29日 - lint機能一通り完成。
*2011年6月3日 - jawptoolに名称変更。
*2011年7月13日 - 0.10公開。
*2011年7月24日 - 0.11公開。修正内容は以下の通り。
**lint-textのチェック項目強化
**lint-textの出力件数の上限を10000件に設定。
**titlelistの出力形式を修正
**テスト強化
**多少の高速化
**メモリ使用量の多少の削減
**その他バグ修正
*2011年7月27日 - 0.12公開。修正内容は以下の通り。
**ソースコード整理
**テスト強化
**その他バグ修正
*2011年8月9日 - 0.13公開。修正内容は以下の通り。
**LintText強化
***リンク先が曖昧さ回避またはリダイレクトの場合に警告
***存在しないカテゴリ、テンプレートの呼び出しを警告
**Statistic強化
***発リンクランキング
***節名の使用数ランキング
***外部リンクのドメイン統計
**メモリ使用量の多少の削減
**その他バグ修正
*2011年9月21日 - 0.20公開。修正内容は以下の通り。
**jawp-lint.cgi - 新設
**lint-redirect、lint-index、passed-sakujo、person、noindex、index-list、aimaiの各コマンドを新設
**living-noref - 出力上限1万件の制限を解除
**titlelist - Data::Dumperを使用しないように変更。名前空間ごとに別ファイルに出力するように変更
**statistic - 井戸端統計を追加
**その他バグ修正
*2011年10月5日 - 0.21公開。修正内容は以下の通り。
**lint-title - チェック機能強化
**lint-redirect - チェック機能強化、レポート形式変更
**lint-index - チェック機能強化
**statistic - 議論の統計項目追加
**person - 都道府県別出身人物検出機能追加
**Aimai - 小中高等学校加筆候補検出機能追加
**jawp-lint.cgi - titlelist読み込み機能追加
**多少の高速化
**その他バグ修正
*2011年11月29日 - 0.22公開。修正内容は以下の通り。
**テストをクラスごとに分割しt/に移動
**wiki2html.plの機能強化
**テストの強化とコード整理
**その他バグ修正
*2012年7月25日 - 0.30公開。修正内容は以下の通り。
**passed-sakujoを機能強化しlongterm-requestに変更
**index-listを機能強化しindex-statisticに変更
**shortpage、lonelypage、category-statisticを追加
**personの出力情報を変更
**jawp-lint.cgiをlint-text.cgiにファイル名変更
**lint-title.cgiを追加
**wiki2html.plの機能強化
**manual.htmlの同梱
**その他バグ修正

より詳しい開発の経緯は http://www.saoyagi2.net/wikimedian/ に書かれています(それ以外のことも書いてますが)。

== ライセンス ==
本プログラムはMITライセンスでライセンスされます。

== 付属ツール ==
;t/*.t
:プログラムのテストを行います。全てパスするのが理想ですが、環境によってはパスしないかもしれません。その場合はバグレポートを送っていただけると幸いです。

;wiki2html.pl
:jawptoolの出力は基本的にwikiテキストになっています。これをhtmlに変換するツールです。ただし、現状はごく基本的なwiki記法にしか対応していません。

== 外部リンク ==
* [http://ja.wikipedia.org/wiki/Wikipedia:%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89 Wikipedia:データベースダウンロード]
* [http://dumps.wikimedia.org/jawiki/ ウィキペディア日本語版データベースダンプ]
